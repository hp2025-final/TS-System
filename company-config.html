<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Configuration - POS AURA</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto p-6">
        <div class="bg-white rounded-lg shadow-md p-6">
            <h1 class="text-2xl font-bold text-gray-900 mb-6">Company Configuration</h1>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Company Information -->
                <div class="space-y-4">
                    <h2 class="text-lg font-semibold text-gray-800">Company Information</h2>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                        <input type="text" id="companyName" value="Tasneem Shamim" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Company Phone</label>
                        <input type="text" id="companyPhone" value="+92 300 0000000" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Website</label>
                        <input type="text" id="website" value="www.tasneemshamim.com" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Facebook</label>
                        <input type="text" id="facebook" value="tasneemshamim.pk" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Instagram</label>
                        <input type="text" id="instagram" value="tasneemshamim.pk" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                <!-- Branch Information -->
                <div class="space-y-4">
                    <h2 class="text-lg font-semibold text-gray-800">Branch Information</h2>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Branch Name</label>
                        <input type="text" id="branchName" value="Tasneem Shamim (Gujranwala)" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Branch Phone</label>
                        <input type="text" id="branchPhone" value="+92 313 6520007" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Branch Address</label>
                        <textarea id="branchAddress" rows="3" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">Fazal Centre, Ground Floor, Main G.T Road, Gujranwala</textarea>
                    </div>
                </div>
            </div>

            <!-- Invoice Settings -->
            <div class="mt-6 space-y-4">
                <h2 class="text-lg font-semibold text-gray-800">Invoice Settings</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Invoice Prefix</label>
                        <input type="text" id="invoicePrefix" value="TS-" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Thermal Width (mm)</label>
                        <input type="number" id="thermalWidth" value="70" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Default Tax Rate (%)</label>
                        <input type="number" id="defaultTax" value="17.00" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="mt-8 flex space-x-4">
                <button onclick="updateConfig()" 
                        class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    Update Configuration
                </button>
                
                <button onclick="previewInvoice()" 
                        class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">
                    Preview Invoice
                </button>
                
                <a href="/" 
                   class="px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 inline-block text-center">
                    Back to POS
                </a>
            </div>

            <!-- Instructions -->
            <div class="mt-6 p-4 bg-blue-50 rounded-md">
                <h3 class="text-sm font-medium text-blue-800 mb-2">Instructions:</h3>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li>• Make changes to the configuration as needed</li>
                    <li>• Click "Update Configuration" to save changes</li>
                    <li>• Use "Preview Invoice" to see how the thermal receipt will look</li>
                    <li>• Configuration file location: <code>config/company.php</code></li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Load configuration on page load
        window.onload = function() {
            loadConfig();
        };

        async function loadConfig() {
            try {
                const response = await fetch('/api/company-config');
                if (response.ok) {
                    const config = await response.json();
                    
                    // Populate form fields
                    document.getElementById('companyName').value = config.company.name || '';
                    document.getElementById('companyPhone').value = config.company.company_phone || '';
                    document.getElementById('website').value = config.company.website || '';
                    document.getElementById('facebook').value = config.company.facebook || '';
                    document.getElementById('instagram').value = config.company.instagram || '';
                    document.getElementById('branchName').value = config.branch.name || '';
                    document.getElementById('branchPhone').value = config.branch.phone || '';
                    document.getElementById('branchAddress').value = config.branch.address || '';
                    document.getElementById('invoicePrefix').value = config.invoice.prefix || '';
                    document.getElementById('thermalWidth').value = config.invoice.thermal_width || '';
                    document.getElementById('defaultTax').value = config.tax.default_rate || '';
                } else {
                    console.error('Failed to load configuration');
                }
            } catch (error) {
                console.error('Error loading configuration:', error);
            }
        }

        async function updateConfig() {
            try {
                const configData = {
                    company: {
                        name: document.getElementById('companyName').value,
                        company_phone: document.getElementById('companyPhone').value,
                        website: document.getElementById('website').value,
                        facebook: document.getElementById('facebook').value,
                        instagram: document.getElementById('instagram').value
                    },
                    branch: {
                        name: document.getElementById('branchName').value,
                        phone: document.getElementById('branchPhone').value,
                        address: document.getElementById('branchAddress').value
                    },
                    invoice: {
                        prefix: document.getElementById('invoicePrefix').value,
                        thermal_width: parseInt(document.getElementById('thermalWidth').value),
                        font_size: 12
                    },
                    tax: {
                        default_rate: parseFloat(document.getElementById('defaultTax').value),
                        display_decimals: false
                    }
                };

                const response = await fetch('/api/company-config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(configData)
                });

                if (response.ok) {
                    alert('Configuration updated successfully!\n\nChanges will be reflected in the POS system immediately.');
                } else {
                    const errorData = await response.json();
                    alert('Failed to update configuration:\n' + errorData.message);
                }
            } catch (error) {
                console.error('Error updating configuration:', error);
                alert('Error updating configuration: ' + error.message);
            }
        }

        function previewInvoice() {
            window.open('thermal-print-test.html', '_blank', 'width=400,height=600');
        }
    </script>
</body>
</html>
